<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGM Analysis</title>
  <link rel="stylesheet" href="/assets/css/main.css" />
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  
</head>
<body class="page ">
  <main>
    <h1 id="glycemic-forecaster-predicting-glycemic-response-from-cgm-data-and-food-logs">Glycemic Forecaster: Predicting Glycemic Response from CGM Data and Food Logs</h1>

<p>In this project, I explored the relationship between <strong>diet, exercise, and personal glycemic response</strong> using acquired <strong>Continuous Glucose Monitor (CGM) data</strong> acquired with a Freestyle Libre device. The goal was to build a model that could predict glucose spikes based on meal composition and other factors, providing a framework for personalized nutrition insights.</p>

<h2 id="motivation">Motivation</h2>

<p>The potential of personalized nutrition is immense, and the rich data from CGMs can offer powerful insights. This project also personal - as someone diagnosed with pre-diabetes, I wanted to move beyond the limitations of the A1C test – a lagging three month average – to to understand the immediate, real-time impact of my lifestyle choices on my glucose levels.</p>

<p>To do this, I sought to replicate and adapt methodologies from key scientific papers, aiming to turn my raw glucose readings into actionable insights. The result is not only insights on my own glucose data but also a <a href="https://0198a743-8aac-6e01-b377-b7c90b9f1907.share.connect.posit.cloud/">reusable tool</a> I developed to empower clinicians and other patients to apply these same methodologies to their own data.</p>

<hr />

<h2 id="data--initial-processing">Data &amp; Initial Processing</h2>

<p>The analysis is based on two primary data sources - CGM glucose data and time-stamped meal and exercise logs. The entire data contains a total of <strong>94 meal logs</strong>.
My first step was to establish a comprehensive overview of the user’s glucose profile. This involved summarizing the aggregated data over a 10-14 day CGM wear period, displaying the Ambulatory Glucose Profile (AGP) to visualize the median glucose levels and variability throughout the day. I then calculated key metrics, including <strong>Mean Glucose, Baseline Glucose, Glucose Management Index (GMI)</strong>[1], an estimate of A1C, as well as <strong>Time spent in ranges</strong>[2]. This process mirrored the standard reports generated by devices like the Freestyle Libre, using recommendations from the American Diabetes Association.</p>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/ambulatory_glucose_profile.png" alt="agp" width="800" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 1: Ambulatory glucose profile
  </figcaption>
</figure>

<hr />

<h2 id="feature-engineering-from-meals-to-model-inputs">Feature Engineering: From Meals to Model Inputs</h2>

<p>The project aimed to model how specific meals impacted glucose levels. This required <strong>connecting user-logged meals to their corresponding glucose peaks</strong> and extract meaningful features.</p>

<h3 id="linking-meals-to-glucose-peaks">Linking Meals to Glucose Peaks</h3>

<p>I matched each user-logged meal to a subsequent glucose peak. I created a <strong>two-hour event windows</strong> starting from the time of the logged meal, which assumes that the user logs their food at the beginning of the meal. This allowed me to isolate the glycemic response for each specific food intake. The resulting event windows were visually checked against the observed peaks to ensure accuracy.</p>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/event_windows.png" alt="event windows" width="800" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 2: Calculated Event Windows
  </figcaption>
</figure>

<h3 id="key-challenges-in-meal-to-peak-matching">Key Challenges in Meal-to-Peak Matching</h3>

<ul>
  <li><strong>Overlapping Meal Events</strong> - When meals were eaten in quick succession, their two-hour event windows would overlap, making it impossible to isolate the glycemic impact of a single meal. To ensure the integrity of the analysis, any meal log that occurred within two hours of a preceding one was considered “contaminated” and excluded from the model training set.</li>
  <li><strong>Mismatched and Missing Data</strong> - A perfect 1:1 match between logs and peaks is rare due to normal user logging behavior.
It was common to observe significant glucose <em>peaks without corresponding meal logs</em>. These “unexplained peaks” were excluded from the meal-based analysis. Occasionally, <em>meal logs without corresponding peak</em> were found in the event window. In these cases, the data was manually reviewed to see if the log could be matched with a plausible nearby peak (e.g., a peak that occurred slightly before the log was entered).</li>
  <li><strong>Sensor Malfunctions</strong> - Continuous Glucose Monitors can sometimes produce erroneous readings, especially near the end of their 10-14 day lifespan. One dataset showed clear signs of sensor malfunction in the final days, with erratic and physiologically implausible readings. This required trimming the dataset to remove the faulty data before proceeding with the analysis.</li>
</ul>

<h3 id="using-llms-for-macronutrient-extraction">Using LLMs for Macronutrient Extraction</h3>

<p><strong>A major challenge was converting unstructured, free-text food logs (e.g., “Chipotle bowl”) into structured, analyzable data</strong>. I developed an LLM-based workflow to parse these logs and estimate macronutrients. This workflow involved four key steps:</p>

<ol>
  <li><strong>Meal Classification</strong>: The LLM inferred the meal type (meal, snack, drink) and source (homemade, restaurant).</li>
  <li><strong>Segmentation</strong>: It broke down composite meals into individual components (e.g., “pork bone soup” -&gt; “pork bone”, “soup”, “greens”).</li>
  <li><strong>Portion Allocation</strong>: The LLM assigned weights to each component.</li>
  <li><strong>Macronutrient Estimation</strong>: Finally, it estimated the protein, carbohydrates, fat, and calories for each component and the entire meal, using nutritional databases like USDA where possible.
This process effectively transformed messy text logs into a clean, structured dataset ready for modeling. The outputs were cross-verified where possible with published nutritional information for items like a Chipotle bowl or packaged snacks.</li>
</ol>

<h3 id="key-challenges-encountered">Key Challenges encountered:</h3>

<ul>
  <li><strong>Handling Missing Portion Sizes:</strong> A common issue with self-reported data is the lack of explicit portion sizes. My workflow addressed this by first using the LLM to classify the meal type (e.g., snack vs. dinner), which helped infer reasonable portion sizes.</li>
  <li><strong>Standardizing Mixed-Format Entries:</strong> User logs were inconsistent; some listed individual ingredients while others named a composite meal. The segmentation step was crucial for standardizing this data by breaking down meals like a “chipotle chicken burrito” into their constituent parts.</li>
  <li><strong>Ensuring Traceability and Quality:</strong> To build trust in the LLM’s outputs, I designed the workflow to save its intermediate steps. This created a traceable audit trail, from segmentation to portion allocation to final macronutrient estimates, which served as a guardrail for data quality.</li>
</ul>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/LLM_intermediate.png" alt="intermediate logs" width="800" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 3: Intermediate LLM logs
  </figcaption>
</figure>

<h3 id="calculating-peak-features">Calculating Peak Features</h3>

<p>For each meal-related glucose peak, I calculated several quantitative features to describe its shape and size:</p>

<ul>
  <li><strong>Glucose Max</strong>: The highest point of the peak.</li>
  <li><strong>Area Under the Curve (AUC)</strong>: Calculated as np.trapezoid(max(glucose - baseline, 0)), this captures the total glycemic impact of the meal.</li>
  <li><strong>Rate of Rise/Fall</strong>: The initial slope of the glucose increase and subsequent decrease, which reflects the speed of absorption and insulin feedback.</li>
</ul>

<hr />

<h2 id="modeling-the-glycemic-response">Modeling the Glycemic Response</h2>

<p>With the features engineered, I set out to model the post-meal glucose response. I focused on two target variables: <strong>Glucose AUC and Glucose Rate of Rise</strong>.</p>

<h3 id="model-1-predicting-glucose-auc">Model 1: Predicting Glucose AUC</h3>

<p>I started with a simple <strong>linear regression model</strong> using only carbohydrates to predict glucose_auc. While this showed a positive association for each user, the model explained very little of the variance (low R2 value), indicating that other factors were at play.</p>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/glucose_auc_carbs_by_user.png" alt="simple model" width="500" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 4: Basic Model - AUC by carbs by User.
  </figcaption>
</figure>

<p>I then built a more comprehensive model including all available factors: <em>macronutrients, exercise within 3 hours of the meal, and mealtime category (e.g., morning, afternoon)</em>. After removing multicollinear features (like calories and total weight) and simplifying interaction terms to prevent overfitting, I arrived at a <strong>leaner, more interpretable model</strong>.</p>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/jmp_model_auc.png" alt="jmp_auc" width="500" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 5: AUC Model
  </figcaption>
</figure>

<p>This <strong>model explained about 11% of the variance (R2≈0.11)</strong>, which, while modest, is not unexpected given the inherent noise and complexity of biological data. The key takeaways were:</p>

<ul>
  <li>Carbohydrates had a positive association with glucose AUC.</li>
  <li><strong>Exercise within 3 hours of a meal had a negative association</strong>, tending to reduce the peak size.</li>
  <li>Carbs, exercise, and meal time all showed borderline statistical significance (p≈0.06–0.09), suggesting they are modest but meaningful contributors.</li>
</ul>

<p>I also experimented with a Random Forest model to capture potential non-linear relationships, but it was sensitive to train/test splits and did not perform better than the linear regression.</p>

<h3 id="model-2-predicting-glucose-rate-of-rise">Model 2: Predicting Glucose Rate of Rise</h3>

<p>Pivoting to the rate of rise of the glucose peak yielded a stronger model.</p>

<figure style="text-align: center; margin: 2em 0;">
  <img src="/images/jmp_model_rate_of_rise.png" alt="jmp_ror" width="500" style="display: block; margin: 0 auto;" />
  <figcaption style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
    Figure 6: Rate of Rise Model
  </figcaption>
</figure>

<p>The plot shows a clear positive trend, but the scatter highlights the high natural variability in glycemic response not captured by the model’s features, which is consistent with findings in the field.”</p>

<p>This model performed significantly better, <strong>explaining ~18.3% of the variance (R2≈0.183)</strong>. The results were more definitive:</p>

<ul>
  <li><strong>Carbohydrates showed a statistically significant positive association</strong> with the rate of rise (p=0.002).</li>
  <li><strong>Exercise again showed a marginal negative association (p≈0.084)</strong>, reinforcing its role in dampening glycemic response.</li>
</ul>

<p>This suggests that while the total size of a glucose peak (AUC) is complex and affected by many downstream factors, the initial speed of the glucose spike is more directly and predictably tied to the carbohydrate content of a meal.</p>

<hr />

<h2 id="summary-and-future-value">Summary and Future Value</h2>

<p>This project successfully demonstrates an <strong>end-to-end pipeline for analyzing CGM and food log data to extract personalized insights</strong>. I processed raw data, engineered features from unstructured text using an LLM, and built regression models to understand the drivers of glycemic response.</p>

<p>My model explained <strong>~18% of the variance in glucose rate-of-rise</strong>, a promising result that is in line with foundational studies in the field which also highlight the high interpersonal variability of glycemic response. For reference, an 800 person study[4] reported an R2 of 0.144 for their carbohydrates-only to glucose auc model. That same study eventually achieved a R2 of 0.49 after incorporating a vast array of additional features—including blood tests and microbiome data which suggests a potential upper limit for predictability with more comprehensive datasets.</p>

<p>While a LLM is not a substitute for precise food logging, it reflects the practical reality that most people cannot weigh and measure their macronutrients for every meal. Acknowledging these limitations, the workflow was designed for maximum transparency, with traceable intermediate outputs to ensure the LLM’s logic could be followed and validated.
The key findings confirmed that carbohydrates are a significant driver of glucose spikes, while exercise can help mitigate them. Furthermore, modeling the rate of rise proved to be more effective than modeling the total AUC.</p>

<h3 id="potential-applications">Potential Applications</h3>

<p>With more data and refinement, this modeling approach could power several high-value features and applications:</p>

<ul>
  <li><strong>Personalized User Tools</strong>: Develop a <em>“carb sensitivity”</em> score, allow users to compare meal impacts, and provide actionable feedback on meal timing and composition. This could include recommendations like, “A 20-minute walk within an hour of this meal is likely to reduce the glucose spike”.</li>
  <li><strong>Clinical &amp; Research Applications</strong>: Use glycemic variability metrics to help stratify pre-diabetic risk, monitor dietary program adherence, and provide anonymized, aggregate data to nutrition researchers.</li>
</ul>

<h3 id="tools-used">Tools Used:</h3>

<ul>
  <li>Python</li>
  <li>pandas</li>
  <li>scikit-learn</li>
  <li>JMP</li>
  <li>plotly</li>
</ul>

<h3 id="references">References</h3>

<ol>
  <li>Glucose Management Indicator (GMI): A New Term for Estimating A1C From Continuous Glucose Monitoring, Bergenstal et Al. 2018.</li>
  <li>Clinical Targets for Continuous Glucose Monitoring Data Interpretation: Recommendations From the International Consensus on Time in Range, ADA. 2019.</li>
  <li>Statistical Tools to Analyze Continuous Glucose Monitor Data, William Clarke, M.D. and Boris Kovatchev, Ph.D. 2008.</li>
  <li>Personalized Nutrition by Prediction of Glycemic Responses, Zeevi et al</li>
</ol>

  </main>
</body>
</html>